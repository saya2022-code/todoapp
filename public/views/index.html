<!DOCTYPE html>
<html lang="ja">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="../stylesheets/style.css" />

    <title>Todoã‚¢ãƒ—ãƒª</title>
  </head>
  
  <body>
    <!-- ğŸ” -->
    <input id="menu" type="checkbox" />
    <label for="menu" class="open">ğŸ”</label>
    <label for="menu" class="back"></label>
    <!-- ğŸ” -->

<article>
  <div class="side">
    <p>ã‚µã‚¤ãƒ‰ãƒãƒ¼</p>
    <aside>
      <!-- ğŸ” -->
      <label for="menu" class="close">Ã—</label>
      <!-- ğŸ” -->

      <nav>
          <ul class="menu-side">
              <li>list1</li>
              <li>list2</li>
              <li>list3</li>
              <li>list4</li>
              <li>list5</li>
          </ul>
      </nav>
      <div>
          side footer
      </div>
  </aside>
  </div> 
  

  <div class="main">
  <!-- header -->
<header>
<h1 class="headline">
  <a>TO DO ãƒªã‚¹ãƒˆ</a>
</h1>
<!-- <ul class="nav-list">
  <li class="nav-list-item">
    <a>Home</a>
  </li>
  <li class="nav-list-item">About</li>
  <li class="nav-list-item">Topic</li>
</ul> -->
<div class="button-box">
  <button type="button" class="btn btn-success" id="create-Task" data-toggle="modal" data-target="#createModal">
    ï¼‹ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ </button>
    
  <button id="deadTask-button" class="deadTask-button"></button>
 
  <button id="ongoing-button" class="ongoing-button">é€²è¡Œä¸­ã§çµã‚Šè¾¼ã¿</button>

  <button id="deadTask-Cbutton" class="deadTask-Cbutton"></button>
</div>
</header>

      <div class="header-box">
  
        <div class="container">
          <!-- Content here -->
          <!-- <button type="button" class="btn btn-success" id="create-Task" data-toggle="modal" data-target="#createModal">
            ï¼‹ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ </button> -->

          <!-- è¿½åŠ Modal -->
            <div class="modal fade" id="createModal" tabindex="-1" role="dialog" aria-labelledby="createModal" aria-hidden="true">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="createModal">ã‚¿ã‚¹ã‚¯ã€€ç™»éŒ²</h5>
                    <button type="button"  class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body" id="create-form">
                    <label for="taskName">ã‚¿ã‚¹ã‚¯</label>
                    <input id="taskName" class="form-control" name="taskName"/>
                    <p id="taskName-error"></p>
                    
                    <label for="deadline">æœŸé™ <br></label>
                    <input type="date" id="deadline" class="form-control" name="deadline"/>
                    <p></p>

                    <label for="category">ã‚«ãƒ†ã‚´ãƒª <br></label>
                    <select id="category" class="form-control" name="category">
                      <option value="1">ç”Ÿæ´»</option>
                      <option value="2">å‹‰å¼·</option>
                      <option value="3">ä»•äº‹</option>
                      <option value="4">è¶£å‘³</option>
                    </select>
                    <label for="tagName">ã‚¿ã‚°</label>
                      <input id="tagName" class="form-control" name="tagName"/>
                  </div>

                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    <button type="button" id="register-Task" class="btn btn-primary">ç™»éŒ²</button>
                  </div>
                </div>
              </div>
            </div>

          <!-- æ›´æ–°Modal ãƒ†ã‚¹ãƒˆ-->
            <div class="modal fade" id="altermodal" tabindex="-1" role="dialog" aria-labelledby="altermodal" aria-hidden="true">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" >ã‚¿ã‚¹ã‚¯ã®æ›´æ–°</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">

                    <label for="taskName">ã‚¿ã‚¹ã‚¯</label>
                    <input id="taskName" class="form-control" name="taskName"/>
                    <p id="taskName-error"></p>
                    <label for="deadline">æœŸé™</label>
                    <input type="date" id="deadline" class="form-control" name="deadline"/>
                    <p></p>

                    <label for="category">ã‚«ãƒ†ã‚´ãƒª</label>
                    <select id="category" class="form-control" name="category">
                      <option value="1">ç”Ÿæ´»</option>
                      <option value="2">å‹‰å¼·</option>
                      <option value="3">ä»•äº‹</option>
                      <option value="4">è¶£å‘³</option>
                    </select>

                    <p></p>
                    <label for="status">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label>
                    <select id="status" class="form-control" name="status">
                      <option value="1">æœªå®Œäº†</option>
                      <option value="2">é€²è¡Œä¸­</option>
                      <option value="3">çµ‚äº†</option>
                    </select>

                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    <button type="button" id="alter-Task" class="btn btn-primary">ä¿å­˜</button>
                  </div>
                </div>
              </div>
            </div>
          <!-- å‰Šé™¤Modal -->
            <div class="modal fade" id="deletemodal" tabindex="-1" role="dialog" aria-labelledby="deletemodalLabel" aria-hidden="true">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="deletemodalLabel">ä¸‹è¨˜ã®ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-bodys" id="deletemodal-body">
                    <p id="memo"></p>
                  </div>
                  <div class="deletemodal-footer">
                    <button type="button" id="cancel-button" class="btn btn-secondary btn-sm" data-dismiss="modal">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    <button type="button" id="deletemodal-get" class="btn btn-primary btn-sm">OK</button>
                  </div>
                </div>
              </div>
            </div>
        </div>
      </div>
    

    <div class="search-area">
      <form>
        <input type="text" id="search-text" placeholder="æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›">
      </form>
      <div class="search-result">
        <div class="search-result__hit-num"></div>
        <div id="search-result__list"></div>
      </div>
    </div>

  <div class="task-body">
    <div class="taskList" id="taskList">
      

      <table bgcolor="#FFFFFF" id="dead-table">
        <thead>
          <tr class="taskHead">
            <th></th>
            <td >ã‚¿ã‚¹ã‚¯å</td>
            <td >æœŸé™</td>
            <td >ã‚«ãƒ†ã‚´ãƒªãƒ¼</td>
            <td>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</td>
            <td>æ›´æ–°ãƒ»å‰Šé™¤</td>
          </tr>
      </thead >
      <tbody id="list-contents" class="list-contents">    
        <!-- ã“ã®é–“ã«returnãŒå…¥ã‚‹ -->
      </tbody>
    </table>
    </div>

    
    <!-- ã‚«ã‚¦ãƒ³ãƒˆãƒ†ãƒ¼ãƒ–ãƒ« -->
      <div class="sticky-top">
              <table class="table table-bordered">
                  <tr id="table-count">
                      <td>ç¾åœ¨ã®ã‚¿ã‚¹ã‚¯æ•°</td>
                      <td>çµ‚äº†æ¸ˆã¿ã‚¿ã‚¹ã‚¯</td>
                      <td>æ®‹ã‚Šã®ã‚¿ã‚¹ã‚¯</td>
                  </tr>
                   <tr>
                    <td><span class="totalCount" id="all-count"></span> å€‹</td>
                    <td><span class="cntComp" id="cntComp"></span> å€‹
                      <td><span class="cnt-Left" id="cntLeft"></span> å€‹</td>
                  </tr>
              </table>
      </div> <!-- /.countTable -->


    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>

    <script src="../javascripts/add.js"></script>
    <script src="../javascripts/taskCount.js"></script>
    <script src="../javascripts/index.js"></script>
    <script>
      
      //æ–°è¦ç™»éŒ²
      $("#register-Task").on("click", async function() {

        // alert("ã“ã®å†…å®¹ã§ç™»éŒ²ã—ã¾ã™ã‹ï¼Ÿ");
        const deleteName = $(this).data("delete");
        // if(confirm(`ã“ã®å†…å®¹ã§ç™»éŒ²ã—ã¾ã™ã‹ï¼Ÿ`) == true){

        //ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰å–å¾— -->
        const requestData = {
          taskName : $("#taskName").val(),
          deadline : $("#deadline").val(),
          category : $("#category").val(),
        };
      
        //æ–°è¦ç™»éŒ²APIã‚’å®Ÿè¡Œ
      const respons = await httpPost(
        "//" + window.location.host + "/api/tasks",
        requestData
      );

      //ç”»é¢ã‚’ãƒªãƒ­ãƒ¼ãƒ‰
        window.location.reload();
      // }else{
      //   return false;
      // }

      });
    
      //ä¸€è¦§
      $(async function() {
        const data = await httpGet("//" + window.location.host +"/api/list");
        let  cntComp = 0;
        const lists = data.map((item) => {
          console.log(item);
           
          // æ—¥ä»˜ã‚’ å¹´æœˆæ—¥ã«å¤‰æ›
          const createDate = new Date(item.deadline);
          const year = createDate.getFullYear();
          const month = createDate.getMonth() + 1;
          const day = createDate.getDate();
          const deadline = year + "å¹´" + month + "æœˆ" + day + "æ—¥";

          //ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®valueã‚’ãƒ†ã‚­ã‚¹ãƒˆã«å¤‰ãˆã‚‹
          const statusValue = item.task_status; 
          var status = ""; 
          var statusClass = "";   
             
          if(statusValue == 1){
           status = "æœªå®Œäº†";
           statusClass = "status-red";
          //  document.getElementById("td-head").style.backgroundColor ='red'
          }else if(statusValue == 2){
           status = "é€²è¡Œä¸­";
           statusClass = "status-blue";
          }else if(statusValue == 3){
           status = "çµ‚äº†";
           statusClass = "status-green";
           cntComp += 1;
          }
          console.log(cntComp);

          return `<tr>
                  <div id="tdh">
                  <td width="2%" id="td-head" class=${statusClass}></td>
                  <td width="40%">${item.task_name} <li style="font-size: small;">ã‚¿ã‚°</li></td>
                  <td width="15%">${deadline}</td>
                  <td width="10%">${item.category_name}</td>
                  <td width="10%">${status}</td>
                  <td width="18%"><button type="button" class="btn btn-primary "data-toggle="modal" data-target="#altermodal" id="altermodal-get" data-id=${item.id}>æ›´æ–°</button>
                  <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#deletemodal" data-id=${item.id} data-delete=${item.task_name} id="delete-button" >å‰Šé™¤</button></td>
                  </div>
                  </tr>`;    
        });
        $(".list-contents").append(lists);
        $(".cntComp").append(cntComp);

        
        //ã‚¿ã‚¹ã‚¯ã®ç·æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ(cntAll)
        var cntAll = document.getElementById("list-contents").childElementCount;
        document.getElementById("all-count").innerHTML = cntAll;

        //å®Œäº†ã—ãŸã‚¿ã‚¹ã‚¯(cntComp)
        // æ®‹ã‚¿ã‚¹ã‚¯æ•°(cntAll-cntComp)
        var cntLeft = cntAll-cntComp;
        // console.log(cntLeft);
        document.getElementById("cntLeft").innerHTML = cntLeft
      });

    //1ä»¶å–å¾—
    $(document).on("click","#altermodal-get",async function(){
      const id = $(this).data("id");
      const response = await httpGet(        
        "//" + window.location.host + `/api/list/${id}`,
      );
      console.log(response);

    //æ—¥ä»˜ã‚’ å¹´æœˆæ—¥ã«å¤‰æ›
      const date = new Date(response[0].deadline);
      const year = date.getFullYear();
      const month = ("0" + (date.getMonth() + 1)).slice(-2);
      const day = ("0" + date.getDate()).slice(-2);
      const deadline = `${year}-${month}-${day}`;

      console.log($("#altermodal input[name=id]"));
    //åˆæœŸå€¤ã®ã‚»ãƒƒãƒˆ
     $("#altermodal input[name=id]").val(response[0].id);
     $("#altermodal input[name=taskName]").val(response[0].task_name);
     $("#altermodal input[name=deadline]").val(deadline);
     $("#altermodal select[name=category]").val(response[0].category_id);
     $("#altermodal select[name=status]").val(response[0].task_status);
    });

      //æ›´æ–°ãƒœã‚¿ãƒ³â†’ä¿å­˜ãƒœã‚¿ãƒ³
      $(document).on("click","#altermodal-get",async function(){
      $("#alter-Task").data("id",$(this).data("id"));
      console.log($("#alter-Task").data("id")); //ã“ã®3è¡Œã ã¨IDå–å¾—ã§ãã‚‹
      });

        //ä¿å­˜ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸæ™‚ã®å‡¦ç†
        $('#alter-Task').on("click",async function(){
          console.log($(this).data("id")); //æˆåŠŸ(deleteã¨åŒã˜æ§‹æˆã§æ›¸ãã¨è‰¯ã„)

        //ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰å–å¾— -->
        const requestData = {
          taskName : $("#altermodal input[name=taskName]").val(),
          deadline : $("#altermodal input[name=deadline]").val(),
          category : $("#altermodal select[name=category]").val(),
          status : $("#altermodal select[name=status]").val(),
        };

        //æ›´æ–°APIã‚’å®Ÿè¡Œ
          const response = await httpUpdate(
          "//" + window.location.host + `/api/list/${$(this).data("id")}`,
          requestData
          );
          console.log(response);
         
          //ç”»é¢ã‚’ãƒªãƒ­ãƒ¼ãƒ‰
          window.location.reload();
          
    });


    //å‰Šé™¤ãƒœã‚¿ãƒ³â†’okãƒœã‚¿ãƒ³
      $(document).on("click","#delete-button",async function(){
      
      $("#deletemodal-get").data("id",$(this).data("id"));
      $("#deletemodal-body").data("delete",$(this).data("delete")); //ç¬¬2å¼•æ•°ã¾ã§deleteã‚’ã‚»ãƒƒãƒˆã™ã‚‹å¿…è¦
      console.log($(this).data("id"));  
      console.log($("#deletemodal-body").data("delete"));//taskNameã‚’å–ã‚ŒãŸ    
      
      var str = $("#deletemodal-body").data("delete");
      document.getElementById('deletemodal-body').innerHTML = str ; //ãƒ¢ãƒ¼ãƒ€ãƒ«ã«ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºæˆåŠŸï¼

    });


    //okãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸæ™‚ã®å‡¦ç†
    $('#deletemodal-get').on("click",async function(){
      console.log($(this).data("id"));
      
    //å‰Šé™¤APIã‚’å®Ÿè¡Œ
     const response = await httpDelete(        
    "//" + window.location.host + `/api/list/${$(this).data("id")}`,
    );
      console.log(response);

      //ç”»é¢ã‚’ãƒªãƒ­ãƒ¼ãƒ‰
      window.location.reload();
    });
 
  </script>
  </body>
</div>
</article>

<footer>
    <h3 class="h6">é–²è¦§æ¨å¥¨ç’°å¢ƒ</h3>
    <div class="small">
        <p><a href="https://github.com/kde-space/TO_DO_APP" target="_blank">ãã®ä»–ä½¿ã„æ–¹ãªã©ã¯ã“ã¡ã‚‰</a>
        </p>
    </div>
</footer>
</html>
